## 架构目标
- 传统项目：OA、CRM、HR等系统面向企业员工
- 互联网项目：天猫、微信、百度等面向所有网络使用者
    - 用户多
    - 流量大、并发高
    - 海量数据
    - 易受攻击
    - 功能繁琐
    - 变更快

1. 并发量
2. 用户体验：美观、功能、速度、稳定性

### 大型互联网项目架构目标
- 高性能
- 高可用
- 可伸缩
- 高可扩展
- 安全性
- 敏捷性

### 架构演变
单体 --> 垂直 --> 分布式 --> SOA --> 微服务
- 单体架构
- 垂直架构
- 分布式架构
- SOA架构： Dubbo
- 微服务架构：SpringCloud

## Dubbo
- 阿里巴巴开源，高性能、轻量级的Java RPC框架
- 致力于提供高性能、透明化的RPC服务调用，以及SOA服务治理方案

- 注册中心：zookeeper
    
### Dubbo高级配置 

-  序列化
JavaBean必须实现Serializable接口

- 地址缓存
    - dubbo消费者第一次调用时，会将地址缓存到本地，之后的调用不会访问注册中心
    - 如果服务提供者地址发生变化，注册中心会通知服务消费者

- 超时与重试
    - 消费着在调用服务提供者发生了阻塞、等待的场景，这个时候消费者会一直等待下去。如果在某个峰值时刻，大量的请求同时请求服务消费者，会造成线程的大量堆积，势必引发雪崩。
    - dubbo利用超时机制来解决这个问题，设置一个超时时间，在这个时间段内，如果无法完成服务访问，则自动断开连接。  
    - 使用timeout属性配置超时时间，默认1000，单位ms
    - 为了防止因为网络抖动导致的连接断开，Dubbo提供了重试机制来避免。默认两次。

-  多版本
    - 灰度发布：当出现新版本时，让一部分用户先使用新功能，用户反馈没有问题的时候再将所有用户迁移到新功能。  
    - dubbo中通过version属性来设置和调用同一个接口的不同版本。  

- 负载均衡  
    四种负载均衡策略：    
    1. Random：按权重随机，默认值。按照权重进行随机。 
    2. RoundRobin：按照权重轮询
    3. LeastActive：最小活跃调用数，调用数相同随机。
    4. ConsistentHash：一致性Hash，参数相同的请求总是发送到同一提供者。 

-  集群容错  
    集群容错机制  
    - Failover Cluster：失败重试，默认值。当出现失败，重试其他服务器，默认重试2次。一般用于读操作。
    - Failfast Cluster：快速失败，只发起一次调用，失败立即报错。通常用于写操作。
    - Failsafe Cluster：失败安全，出现异常忽略，返回一个空结果。
    - Failback Cluster：失败自动恢复，后台记录失败请求，定时重发。
    - Forking Cluster：并行调用多个服务器，只要一个成功即返回。
    - Broadcast Cluster：广播调用多个提供者，有一台报错即报错。 

- 服务降级  
    服务降级方式
    - mock = force:return null  
    - mock = fail:return null
