# Redis内存
## 内存消耗在哪里？
### 内存使用统计
```bash
127.0.0.1:6379> info memory
# Memory
used_memory:893392
used_memory_human:872.45K
used_memory_rss:10334208
used_memory_rss_human:9.86M
used_memory_peak:13480240
used_memory_peak_human:12.86M
used_memory_peak_perc:6.63%
used_memory_overhead:835960
used_memory_startup:812272
used_memory_dataset:57432
used_memory_dataset_perc:70.80%
allocator_allocated:956304
allocator_active:1277952
allocator_resident:3559424
total_system_memory:1019351040
total_system_memory_human:972.13M
used_memory_lua:30720
used_memory_lua_human:30.00K
used_memory_scripts:0
used_memory_scripts_human:0B
number_of_cached_scripts:0
maxmemory:0
maxmemory_human:0B
maxmemory_policy:noeviction
allocator_frag_ratio:1.34
allocator_frag_bytes:321648
allocator_rss_ratio:2.79
allocator_rss_bytes:2281472
rss_overhead_ratio:2.90
rss_overhead_bytes:6774784
mem_fragmentation_ratio:12.12
mem_fragmentation_bytes:9481832
mem_not_counted_for_evict:634
mem_replication_backlog:0
mem_clients_slaves:0
mem_clients_normal:20504
mem_aof_buffer:640
mem_allocator:jemalloc-5.1.0
active_defrag_running:0
lazyfree_pending_objects:0
lazyfreed_objects:0
```
`info memory`命令获取内存相关指标   

| 属性名                     | 属性说明                                    |
|-------------------------|-----------------------------------------|
| used_memory             | Redis分配器分配的内存总量，也就是内部存储的所有数据内存总占有量      |
| used_memory_human       | 可读格式返回used_memory                       |
| used_memory_rss         | 从操作系统角度显示Redis进程占有的物理内存总量               | 
| used_memory_peak        | 内存使用的最大值，表示used_memory的峰值               |
| used_memory_peak_human  | 可读格式返回used_memory_peak                  | 
| used_memory_lua         | Lua引擎所消耗的内存大小                           |
| mem_fragmentation_ratio | used_memory_rss / used_memory比值，表示内存碎片率 |
| mem_allocatior          | Redis使用的内存分配器，默认为jemalloc               |

> - 当`mem_fragmentation_ratio`\>1时，说明used_memory_rss - used_memory多出的部分内存并没有用于数据存储，而是被内存碎片消耗，
> 如果两者相差很大，说明碎片率很严重。 
> - 当`mem_fragmentation_ratio`\<1时，这种情况一般是操作系统把redis内存交换到硬盘导致，由于硬盘的速度远远小于内存，Redis性能会很差，
> 甚至僵死。  

### Redis内存消耗划分  
- 自身内存
   > Redis占用内存最大的一块，存储所有用户数据。Redis所有数据类型都是key-value数据类型，每次创建键值对时至少创建两个类型对象:key对象和value对象。
   > 对象内存消耗可以简单理解为sizeof(key)+sizeof(value)。
- 对象内存
- 缓冲内存
- 内存碎片


## 如何管理内存？


## 如何优化内存？

